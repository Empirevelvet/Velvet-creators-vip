<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Inscription</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<header>
  <nav>
    <a class="cta" href="login.html">Se connecter</a>
  </nav>
</header>

<div class="panel" style="max-width:920px;margin:8vh auto 10vh;">
  <h1>Inscription</h1>
  <p class="lead" style="text-align:center;margin:0 0 14px;">
    Remplissez ce formulaire pour soumettre votre demande. Nous validerons votre profil (majorité & conformité).
  </p>

  <!-- FORMULAIRE -->
  <form id="signupForm" class="form-grid" autocomplete="off" enctype="multipart/form-data" novalidate>

    <!-- Identifiants -->
    <div>
      <label for="username">Pseudo (obligatoire)</label>
      <input class="input" id="username" name="username" placeholder="@pseudo" required type="text"/>
      <div class="help">Ceci sera affiché publiquement sur votre profil.</div>
    </div>

    <div>
      <label for="email">Email</label>
      <input class="input" id="email" name="email" placeholder="vous@example.com" required type="email"/>
    </div>

    <div>
      <label for="password">Mot de passe</label>
      <input class="input" id="password" name="password" placeholder="Min. 6 caractères" minlength="6" required type="password"/>
      <div class="help">Utilisé à l’activation de votre compte.</div>
    </div>

    <!-- Coordonnées -->
    <div>
      <label for="fullname">Nom complet</label>
      <input class="input" id="fullname" name="fullname" placeholder="Prénom Nom" required type="text"/>
    </div>

    <div>
      <label for="phone">Téléphone</label>
      <input class="input" id="phone" name="phone" placeholder="+41 ..." required type="tel"/>
    </div>

    <div>
      <label for="address">Adresse</label>
      <input class="input" id="address" name="address" placeholder="Rue, numéro, ville" required type="text"/>
    </div>

    <div>
      <label for="country">Pays</label>
      <input class="input" id="country" name="country" placeholder="Votre pays" required type="text"/>
    </div>

    <div>
      <label for="dob">Date de naissance</label>
      <input class="input" id="dob" name="dob" required type="date"/>
    </div>

    <!-- Rôle -->
    <fieldset>
      <legend>Vous êtes :</legend>
      <label><input type="radio" name="role" value="creator" required/> Créatrice</label>
      <label><input type="radio" name="role" value="client" required/> Client</label>
    </fieldset>

    <!-- Uploads -->
    <div>
      <label for="avatar">Photo de profil</label>
      <input class="input" id="avatar" name="avatar" type="file" accept=".jpg,.jpeg,.png"/>
    </div>

    <div>
      <label for="id_front">Pièce d’identité (recto)</label>
      <input class="input" id="id_front" name="id_front" type="file" required accept=".jpg,.jpeg,.png"/>
    </div>

    <div>
      <label for="id_back">Pièce d’identité (verso)</label>
      <input class="input" id="id_back" name="id_back" type="file" required accept=".jpg,.jpeg,.png"/>
    </div>

    <div>
      <label for="selfie">Selfie avec pièce d’identité</label>
      <input class="input" id="selfie" name="selfie" type="file" required accept=".jpg,.jpeg,.png"/>
    </div>

    <!-- Consentement -->
    <div>
      <input id="consent" name="consent" type="checkbox" required/>
      <label for="consent">Je certifie avoir 18 ans révolus et j’accepte la modération humaine de mes documents.</label>
    </div>

    <!-- Bouton -->
    <div class="form-actions">
      <button class="btn gold" type="submit">Envoyer ma demande</button>
      <a class="btn" href="login.html">Déjà inscrit(e) ? Se connecter</a>
    </div>
  </form>

  <p class="help" style="text-align:center; margin-top:14px">
    Pour les créatrices, vos paiements seront envoyés uniquement via PayPal.<br>
    Merci de renseigner votre adresse PayPal dans votre espace privé après validation.
  </p>
</div>

<footer class="footer">
  <a href="legal.html">Mentions légales & CGU</a>
</footer>

<!-- Script -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const form = document.querySelector('#signupForm');
  if (!form) return;

  form.removeAttribute('data-netlify');
  form.removeAttribute('netlify');
  form.removeAttribute('action');

  const msg = document.createElement('div');
  msg.id = 'signup-msg';
  msg.style.marginTop = '10px';
  form.appendChild(msg);

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    msg.textContent = 'Envoi en cours…';
    msg.style.color = '#aaa';

    try {
      const fd = new FormData(form);
      const r = await fetch('/.netlify/functions/signup', { method: 'POST', body: fd });
      const j = await r.json().catch(() => ({}));

      if (r.ok && j && j.success) {
        msg.textContent = '✅ Demande envoyée. Validation sous peu…';
        msg.style.color = '#7CFC00';
        setTimeout(() => { window.location.href = 'thanks.html'; }, 800);
      } else {
        msg.textContent = j.error || 'Erreur lors de l’inscription.';
        msg.style.color = '#ff6b6b';
      }
    } catch (err) {
      msg.textContent = 'Erreur réseau. Réessayez.';
      msg.style.color = '#ff6b6b';
      console.error(err);
    }
  });
});
</script>

</body>
</html>
