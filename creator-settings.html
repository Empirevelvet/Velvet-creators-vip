<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Paramètres créatrice</title>
  <link href="styles.css" rel="stylesheet" />
  <style>
    .box{max-width:640px;margin:8vh auto;padding:24px 22px;border-radius:18px;background:rgba(18,18,18,.92);box-shadow:0 18px 54px rgba(0,0,0,.5)}
    .row{display:grid;gap:12px;margin:10px 0}
    label{font-weight:600}
    input,select{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(20,20,20,.6);color:#efe7d2}
    .btn{display:inline-block;padding:12px 18px;border-radius:12px;border:1px solid rgba(233,200,122,.25);background:linear-gradient(180deg,#edb85f,#d8b565);font-weight:700;color:#141416;text-decoration:none}
    .note{opacity:.75;font-size:.95rem;margin-top:8px}
    .ok{color:#9ae6b4;margin-top:10px}
    .err{color:#feb2b2;margin-top:10px}
  </style>
</head>
<body>
  <header class="header">
    <nav class="nav">
      <a class="cta" href="index.html">Accueil</a>
      <a class="cta" href="signup.html">S’inscrire</a>
      <a class="cta" href="login.html">Connexion</a>
    </nav>
  </header>

  <main>
    <section class="box">
      <h1>Paramètres créatrice</h1>
      <p class="note">Définissez votre prix d’abonnement (minimum <strong>12.90 CHF</strong>) et votre e‑mail PayPal pour les virements.</p>

      <div class="row">
        <label for="creatorId">Identifiant créatrice (slug — ex. <em>sofia</em>)</label>
        <input id="creatorId" placeholder="ex. velvet" required>
      </div>

      <div class="row">
        <label for="displayName">Nom affiché</label>
        <input id="displayName" placeholder="Votre nom public" required>
      </div>

      <div class="row">
        <label for="paypal">E‑mail PayPal (obligatoire)</label>
        <input id="paypal" type="email" inputmode="email" placeholder="ex. nom@domaine.com" required>
      </div>

      <div class="row">
        <label for="price">Prix d’abonnement (CHF)</label>
        <input id="price" type="number" step="0.05" min="12.9" placeholder=">= 12.90" required>
      </div>

      <div class="row">
        <button class="btn" id="save">Enregistrer</button>
      </div>

      <p id="msg" class="note"></p>
    </section>
  </main>

  <script>
    const MIN_PRICE = 12.90;
    const $ = (id) => document.getElementById(id);
    $('save').addEventListener('click', async () => {
      const payload = {
        id: $('creatorId').value.trim().toLowerCase(),
        displayName: $('displayName').value.trim(),
        paypalEmail: $('paypal').value.trim(),
        price: parseFloat($('price').value),
        currency: 'CHF',
        updatedAt: new Date().toISOString()
      };

      const msg = $('msg');
      msg.className = 'note';
      msg.textContent = 'Enregistrement…';

      // validations côté client
      if (!payload.id || !payload.displayName || !payload.paypalEmail || isNaN(payload.price)) {
        msg.className = 'note err';
        msg.textContent = 'Veuillez compléter tous les champs.';
        return;
      }
      if (payload.price < MIN_PRICE) {
        msg.className = 'note err';
        msg.textContent = `Le prix minimum est ${MIN_PRICE.toFixed(2)} CHF.`;
        return;
      }

      try {
        const res = await fetch('/api/upsert-creator', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        if (!res.ok || !data.success) throw new Error(data.error || 'Erreur serveur');
        msg.className = 'note ok';
        msg.textContent = 'Paramètres enregistrés ✅';
      } catch (e) {
        msg.className = 'note err';
        msg.textContent = 'Erreur: ' + e.message;
      }
    });
  </script>
</body>
</html>
